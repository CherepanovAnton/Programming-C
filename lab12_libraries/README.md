# Многофайловый проект. Статические и динамические библиотеки 
## Сборка статической
```bash
gcc app.c -c
gcc log.c -c

ar rc libMY_LOG.a log.o

gcc app.o -o static_exe -L. -lMY_LOG
./static_exe
```
где
- **ar** - команда для архивации, 
- **libMY_LOG.a** - статическая библиотека, lib - префикс, MY_LOG - имя библиотеки, а .a расширение, 
у всех библиотек обязательно есть префикс lib и расширение         

Опции **`-L`. и `-lMY_LOG`** нужны для **линковщика**, т.к. наша библиотека появится там, где ее собрали '.' - текущий каталог, а не в стандартных путях ОС (где ищет линковщик), то нам необходимо прописать путь до нее, -L - путь до каталога с библиотекой, -l имя библиотеки.      

Флаг --static бывает нужен если в этой же папке динамическая библиотека с таким же именем. Компилятор по умолчанию выбирает динамическую библиотеку для линковки               

## Сборка динамической
```bash
gcc app.c -c
gcc log.c -c -fPIC

gcc --shared app.o log.o -o libMY_LOG.so
```
Компиляцией динамической библиотеки занимается компилятор, здесь все в имени файла все как у статической кроме расширения:
- lib - префикс,
- .so - расширение, а 
- MY_LOG - имя библиотеки.       

##### Линковка и запуск

```bash
# -Wl - вызов линковщика, -rpath - путь где искать библиотеку, он вшит в исполняемый файл, '.' - искать в текущем каталоге
gcc app.o -o dynamic_exe -L. -lMY_LOG -Wl,-rpath,.
./dynamic_exe

# Прописать в переменную окружения LD_LIBRARY_PATH путь до нашей дин. библиотеки ('.' - текущий каталог)
gcc app.o -o dynamic_exe -L. -lMY_LOG
LD_LIBRARY_PATH=. ./dynamic_exe
```

Также есть переменная для линковщика позволяющая предзагрузить дин. библиотеку    
```bash
LD_PRELOAD=./libTESTLIB.so ./binary
```
Такой уловкой можно подменить слинкованную библиотеку на любую другую       

Посмотреть список слинкованных динамически библиотек - команда ldd, пример:
```bash
ldd *dynamic_exe*
```   


 


